"use strict";const elementForm=document.querySelector("#js-form"),elementButton=document.querySelector("#js-button"),elementInput=document.querySelector("#js-input"),elemenListFav=document.querySelector("#js-fav-list"),elementListResult=document.querySelector("#js-results-list"),elementReset=document.querySelector("#js-reset"),urlBase="http://api.tvmaze.com/search/shows?q=",elementListFav=document.querySelector("#js-fav-list"),elementItemReset=document.querySelector("#js-reset-item");let listResultContain="",favoritesObj=[];const searchSeriesHandler=()=>{const e=elementInput.value.toLowerCase();fetch(urlBase+e).then(e=>e.json()).then(e=>displaySeries(e))};function displaySeries(e){for(let t of e)null===t.show.image?listResultContain+=`<li class="serie-list" data="${t.show.id}"><span  class="serie--name">${t.show.name}</span><img class="serie--image" src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV"></li>`:listResultContain+=`<li class="serie-list" data="${t.show.id}"><span class="serie--name">${t.show.name}</span><img class="serie--image" src="${t.show.image.medium}"></li>`;elementListResult.innerHTML=listResultContain,createFavorites()}function createFavorites(){const e=document.querySelectorAll(".serie-list");for(let t of e)t.addEventListener("click",showFav)}function showFav(){const e=event.currentTarget,t=e.querySelector(".serie--name"),s=e.querySelector(".serie--image");if(e.classList.toggle("show-background"),e.classList.contains("show-background")){const e={name:t.innerHTML,image:s.src};favoritesObj.push(e),localStorage.setItem("myFavorites",JSON.stringify(favoritesObj)),paintFav(favoritesObj)}else if(!e.classList.contains("show-background")){favoritesObj=JSON.parse(localStorage.getItem("myFavorites"));const e=findIndex(t.innerHTML,favoritesObj);favoritesObj.splice(e,1),localStorage.setItem("myFavorites",JSON.stringify(favoritesObj)),paintFav(favoritesObj)}}function findIndex(e,t){for(let s=0;s<t.length;s++)if(t[s].name===e)return t.indexOf(t[s])}function loadFav(){const e=localStorage.getItem("myFavorites");null!==e&&paintFav(favoritesObj=JSON.parse(e))}function paintFav(e){let t="";for(let s of e)t+=`<div class="fav" id="js-fav"><li class="fav-list"><img src=${s.image} class="fav__image"><span class="fav__title">${s.name}</span><button type="button" id="js-reset-item" class="fav__remove">X</button></li></div>`;elementListFav.innerHTML=t,resetHandlerFav()}const resetFav=()=>{const e=localStorage.getItem("myFavorites");favoritesObj=JSON.parse(e);const t=document.querySelector(".serie-list");""!==elemenListFav.innerHTML&&null!==e&&(elemenListFav.innerHTML="",localStorage.removeItem("myFavorites"),t.classList.remove("show-background"))};function resetHandlerFav(){const e=document.querySelectorAll(".fav__remove");for(let t of e)t.addEventListener("click",resetItem)}const resetItem=e=>{e.currentTarget.closest("li").classList.add("hidden")};function submitHandler(e){e.preventDefault(),searchSeriesHandler()}elementForm.addEventListener("submit",submitHandler),elementButton.addEventListener("click",searchSeriesHandler),window.addEventListener("load",loadFav),elementReset.addEventListener("click",resetFav);